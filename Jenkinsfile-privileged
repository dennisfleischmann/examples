//Inspired by: https://github.com/jenkinsci/kubernetes-plugin/blob/master/README.md#container-group-support
podTemplate(yaml: """
apiVersion: v1
kind: Pod
metadata:
  annotations:
    seccomp.security.alpha.kubernetes.io/pod: runtime/default
spec:
  securityContext:
    runAsUser: 1000
    fsGroup: 1000
  containers:
  - image: ubuntu
    command:
      - "sleep"
      - "604800"
    imagePullPolicy: IfNotPresent
    name: ubuntu
    securitycontext:
      privileged: true
    restartPolicy: Always
""") {

    node(POD_LABEL) {
    
      sh 'echo hello world'
        stage('Run long task') {
            sh 'echo hello world'
            
            git 'https://github.com/jenkins-docs/simple-java-maven-app.git'
            container('ubuntu') {
                stage('Run and run and run...') {
                      sh ' while true; do echo; sleep 1; done'
                }
            }
        }

    }
    
  pipeline {
    echo "A Hello World!"
    sh "echo B Hello from the shell"
    agent { label 'master' }
    stages {
        stage('build') {
            steps {
                echo "C Hello World!"
                sh "echo Hello from the shell"
                sh "hostname"
                sh "uptime"
            }
        }
    }
}
